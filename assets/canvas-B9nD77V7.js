import{g as D,N as U,u as z,v as J,R as K,r as g,t as Q,d as F,j as k}from"./index-TD6eTDnb.js";const Z=n=>{const{componentCls:t}=n;return{[t]:{display:"flex",flexFlow:"row wrap",minWidth:0,"&::before, &::after":{display:"flex"},"&-no-wrap":{flexWrap:"nowrap"},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-space-between":{justifyContent:"space-between"},"&-space-around":{justifyContent:"space-around"},"&-space-evenly":{justifyContent:"space-evenly"},"&-top":{alignItems:"flex-start"},"&-middle":{alignItems:"center"},"&-bottom":{alignItems:"flex-end"}}}},_=n=>{const{componentCls:t}=n;return{[t]:{position:"relative",maxWidth:"100%",minHeight:1}}},ee=(n,t)=>{const{prefixCls:i,componentCls:e,gridColumns:s}=n,o={};for(let r=s;r>=0;r--)r===0?(o[`${e}${t}-${r}`]={display:"none"},o[`${e}-push-${r}`]={insetInlineStart:"auto"},o[`${e}-pull-${r}`]={insetInlineEnd:"auto"},o[`${e}${t}-push-${r}`]={insetInlineStart:"auto"},o[`${e}${t}-pull-${r}`]={insetInlineEnd:"auto"},o[`${e}${t}-offset-${r}`]={marginInlineStart:0},o[`${e}${t}-order-${r}`]={order:0}):(o[`${e}${t}-${r}`]=[{"--ant-display":"block",display:"block"},{display:"var(--ant-display)",flex:`0 0 ${r/s*100}%`,maxWidth:`${r/s*100}%`}],o[`${e}${t}-push-${r}`]={insetInlineStart:`${r/s*100}%`},o[`${e}${t}-pull-${r}`]={insetInlineEnd:`${r/s*100}%`},o[`${e}${t}-offset-${r}`]={marginInlineStart:`${r/s*100}%`},o[`${e}${t}-order-${r}`]={order:r});return o[`${e}${t}-flex`]={flex:`var(--${i}${t}-flex)`},o},W=(n,t)=>ee(n,t),te=(n,t,i)=>({[`@media (min-width: ${z(t)})`]:Object.assign({},W(n,i))}),ne=()=>({}),se=()=>({}),oe=D("Grid",Z,ne),re=n=>({xs:n.screenXSMin,sm:n.screenSMMin,md:n.screenMDMin,lg:n.screenLGMin,xl:n.screenXLMin,xxl:n.screenXXLMin}),xe=D("Grid",n=>{const t=U(n,{gridColumns:24}),i=re(t);return delete i.xs,[_(t),W(t,""),W(t,"-xs"),Object.keys(i).map(e=>te(t,i[e],`-${e}`)).reduce((e,s)=>Object.assign(Object.assign({},e),s),{})]},se),O=["xxl","xl","lg","md","sm","xs"],ie=n=>({xs:`(max-width: ${n.screenXSMax}px)`,sm:`(min-width: ${n.screenSM}px)`,md:`(min-width: ${n.screenMD}px)`,lg:`(min-width: ${n.screenLG}px)`,xl:`(min-width: ${n.screenXL}px)`,xxl:`(min-width: ${n.screenXXL}px)`}),ae=n=>{const t=n,i=[].concat(O).reverse();return i.forEach((e,s)=>{const o=e.toUpperCase(),r=`screen${o}Min`,m=`screen${o}`;if(!(t[r]<=t[m]))throw new Error(`${r}<=${m} fails : !(${t[r]}<=${t[m]})`);if(s<i.length-1){const p=`screen${o}Max`;if(!(t[m]<=t[p]))throw new Error(`${m}<=${p} fails : !(${t[m]}<=${t[p]})`);const C=`screen${i[s+1].toUpperCase()}Min`;if(!(t[p]<=t[C]))throw new Error(`${p}<=${C} fails : !(${t[p]}<=${t[C]})`)}}),n};function ce(){const[,n]=J(),t=ie(ae(n));return K.useMemo(()=>{const i=new Map;let e=-1,s={};return{matchHandlers:{},dispatch(o){return s=o,i.forEach(r=>r(s)),i.size>=1},subscribe(o){return i.size||this.register(),e+=1,i.set(e,o),o(s),e},unsubscribe(o){i.delete(o),i.size||this.unregister()},unregister(){Object.keys(t).forEach(o=>{const r=t[o],m=this.matchHandlers[r];m==null||m.mql.removeListener(m==null?void 0:m.listener)}),i.clear()},register(){Object.keys(t).forEach(o=>{const r=t[o],m=S=>{let{matches:C}=S;this.dispatch(Object.assign(Object.assign({},s),{[o]:C}))},p=window.matchMedia(r);p.addListener(m),this.matchHandlers[r]={mql:p,listener:m},m(p)})},responsiveMap:t}},[n])}const le=g.createContext({});var ue=function(n,t){var i={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.indexOf(e)<0&&(i[e]=n[e]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,e=Object.getOwnPropertySymbols(n);s<e.length;s++)t.indexOf(e[s])<0&&Object.prototype.propertyIsEnumerable.call(n,e[s])&&(i[e[s]]=n[e[s]]);return i};function q(n,t){const[i,e]=g.useState(typeof n=="string"?n:""),s=()=>{if(typeof n=="string"&&e(n),typeof n=="object")for(let o=0;o<O.length;o++){const r=O[o];if(!t[r])continue;const m=n[r];if(m!==void 0){e(m);return}}};return g.useEffect(()=>{s()},[JSON.stringify(n),t]),i}const he=g.forwardRef((n,t)=>{const{prefixCls:i,justify:e,align:s,className:o,style:r,children:m,gutter:p=0,wrap:S}=n,C=ue(n,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:c,direction:y}=g.useContext(Q),[l,a]=g.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),[f,M]=g.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),x=q(s,f),b=q(e,f),v=g.useRef(p),u=ce();g.useEffect(()=>{const I=u.subscribe(A=>{M(A);const R=v.current||0;(!Array.isArray(R)&&typeof R=="object"||Array.isArray(R)&&(typeof R[0]=="object"||typeof R[1]=="object"))&&a(A)});return()=>u.unsubscribe(I)},[]);const h=()=>{const I=[void 0,void 0];return(Array.isArray(p)?p:[p,void 0]).forEach((R,N)=>{if(typeof R=="object")for(let B=0;B<O.length;B++){const H=O[B];if(l[H]&&R[H]!==void 0){I[N]=R[H];break}}else I[N]=R}),I},d=c("row",i),[$,E,X]=oe(d),T=h(),Y=F(d,{[`${d}-no-wrap`]:S===!1,[`${d}-${b}`]:b,[`${d}-${x}`]:x,[`${d}-rtl`]:y==="rtl"},o,E,X),j={},w=T[0]!=null&&T[0]>0?T[0]/-2:void 0;w&&(j.marginLeft=w,j.marginRight=w);const[L,G]=T;j.rowGap=G;const P=g.useMemo(()=>({gutter:[L,G],wrap:S}),[L,G,S]);return $(g.createElement(le.Provider,{value:P},g.createElement("div",Object.assign({},C,{className:Y,style:Object.assign(Object.assign({},j),r),ref:t}),m)))}),de={"cesium-wrap":"_cesium-wrap_1v4tr_1"},fe="f4fc6e359cfa6ca8132a93326965bfbf",V="74facb0d35b1a253231ceebde1e1d421",ge={AMP_KEY:fe},me=()=>[[new Cesium.UrlTemplateImageryProvider({url:"https://www.google.com/maps/vt?lyrs=s@800&x={x}&y={y}&z={z}",tilingScheme:new Cesium.WebMercatorTilingScheme,minimumLevel:1,maximumLevel:30})],[new Cesium.WebMapTileServiceImageryProvider({url:"http://t0.tianditu.com/cva_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cva&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default.jpg&tk="+V,layer:"tdtAnnoLayer",style:"default",format:"image/jpeg",tileMatrixSetID:"GoogleMapsCompatible"})],[new Cesium.WebMapTileServiceImageryProvider({url:"http://t0.tianditu.com/cia_w/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cia&tileMatrixSet=w&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default.jpg&tk="+V,layer:"tdtAnnoLayer",style:"default",format:"image/jpeg",tileMatrixSetID:"GoogleMapsCompatible"})]],be=g.memo(({onUpdate:n,onAdded:t,onDelete:i,...e})=>{const[s,o]=g.useState(),r=g.useRef(null);g.useEffect(()=>(m("cesium-container",{animation:!1,timeline:!1,infoBox:!1,fullscreenButton:!1,homeButton:!1,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,vrButton:!1,geocoder:!1,sceneMode:Cesium.SceneMode.SCENE2D}),()=>{var a;s==null||s.destroy(),(a=r.current)==null||a.destroy()}),[]);async function m(...a){s==null||s.destroy();const f=new Cesium.Viewer(...a);o(f),window.viewer=f,S(f),c(f),C(await p(),f),console.log("init",n==null?void 0:n(s))}async function p(){const a=await new Promise((x,b)=>{var v,u;(u=(v=navigator.geolocation)==null?void 0:v.getCurrentPosition)==null||u.call(v,x,b)}).catch(x=>x),{latitude:f,longitude:M}=(a==null?void 0:a.coords)??{};return a!=null&&a.coords?{latitude:f,longitude:M,height:5e4}:void 0}function S(a){me().forEach(f=>{a.imageryLayers.addImageryProvider(...f)})}function C(a={longitude:118.12181772772028,latitude:24.492788845905654,height:5e4},f=s){const{longitude:M,latitude:x,height:b}=a??{};f==null||f.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(M,x,b),duration:2})}function c(a){const f=new Cesium.ScreenSpaceEventHandler(a.scene.canvas);f.setInputAction(M=>{var b;const x=a.scene.pick(M.position);Cesium.defined(x)&&(x!=null&&x.id)?y(((b=x==null?void 0:x.id)==null?void 0:b.id)??(x==null?void 0:x.id),a):l(M,a)},Cesium.ScreenSpaceEventType.LEFT_CLICK),r.current=f}function y(a,f){f!=null&&f.entities.removeById(a)&&(i==null||i(a))}function l(a,f){const M=f.scene.pickPosition(a==null?void 0:a.position),x=Cesium.Cartographic.fromCartesian(M),b=Cesium.Math.toDegrees(x.longitude),v=Cesium.Math.toDegrees(x.latitude);f.entities.removeAll();const{id:u}=f.entities.add({position:Cesium.Cartesian3.fromDegrees(b,v),point:{pixelSize:10,color:Cesium.Color.RED}}),h={longitude:b,latitude:v,id:u};console.log("postion: ",h),t==null||t(h)}return k.jsx("div",{id:"cesium-container",className:de["cesium-wrap"],...e})});function ye(){const n=g.useRef(null),t=g.useRef(null),i={width:1200,height:800},e={centerX:i.width/2,centerY:i.height/2,hexRadius:200,ballRadius:10,gravity:.5,airResistance:.99,rotationSpeed:.02,restitution:1.85,friction:.7},s=g.useRef({x:0,y:500,width:150,height:150,onMove:!1}),o=c=>{s.current={...s.current,...c}};g.useEffect(()=>{const c=n.current;return c&&r(c),()=>C(c)},[]);function r(c){const y=c.getContext("2d");c.width=i.width,c.height=i.height,m(c);const l={ballX:e.centerX,ballY:e.centerY-e.hexRadius+e.ballRadius+20,vx:2,vy:0,hexRotation:0};function a(u){u.beginPath();for(let h=0;h<6;h++){const d=l.hexRotation+h*Math.PI/3,$=e.centerX+e.hexRadius*Math.cos(d),E=e.centerY+e.hexRadius*Math.sin(d);h?u.lineTo($,E):u.moveTo($,E)}u.closePath(),u.strokeStyle="#000",u.stroke()}function f(){y&&(y.beginPath(),y.arc(l.ballX,l.ballY,e.ballRadius,0,Math.PI*2),y.fillStyle="red",y.fill())}function M(){y&&(y.lineWidth=5,y.beginPath(),y.moveTo(0+s.current.x,0+s.current.y),y.lineTo(s.current.width+s.current.x,s.current.height+s.current.y),y.closePath(),y.stroke())}function x(u,h){const d={x:h.x-u.x,y:h.y-u.y},$={x:l.ballX-u.x,y:l.ballY-u.y},E=Math.max(0,Math.min(1,($.x*d.x+$.y*d.y)/(d.x**2+d.y**2))),X={x:u.x+E*d.x,y:u.y+E*d.y},T=l.ballX-X.x,Y=l.ballY-X.y,j=Math.sqrt(T**2+Y**2);if(j>e.ballRadius)return null;let w={x:d.y,y:-d.x};const L={x:(u.x+h.x)/2,y:(u.y+h.y)/2};w.x*(L.x-e.centerX)+w.y*(L.y-e.centerY)>0&&(w={x:-w.x,y:-w.y});const P=Math.sqrt(w.x**2+w.y**2);return{normal:{x:w.x/P,y:w.y/P},overlap:e.ballRadius-j}}function b(u){const h=u.normal,d=l.vx*h.x+l.vy*h.y;l.vx=(l.vx-(1+e.restitution)*d*h.x)*e.friction,l.vy=(l.vy-(1+e.restitution)*d*h.y)*e.friction,l.ballX+=h.x*u.overlap*1.1,l.ballY+=h.y*u.overlap*1.1}function v(){var h;if(!y)return;y.clearRect(0,0,c.width,c.height),l.hexRotation+=e.rotationSpeed,l.vy+=e.gravity,l.vx*=e.airResistance,l.vy*=e.airResistance,l.ballX+=l.vx,l.ballY+=l.vy;const u=[];for(let d=0;d<6;d++){const $=l.hexRotation+d*Math.PI/3;u.push({x:e.centerX+e.hexRadius*Math.cos($),y:e.centerY+e.hexRadius*Math.sin($)})}for(let d=0;d<6;d++){const $=x(u[d],u[(d+1)%6]);if($){b($);break}}a(y),f(),M(),(h=t.current)==null||h.call(t,y),requestAnimationFrame(v)}v()}function m(c){c.addEventListener("mousemove",p),c.addEventListener("mousedown",p),c.addEventListener("mouseup",p)}function p(c){const{movementX:y,movementY:l}=c??{},a=s.current;switch(c.type){case"mousedown":o({onMove:!0});break;case"mouseup":o({onMove:!1});break;case"mousemove":s.current.onMove&&S(c)&&o({x:a.x+y,y:a.y+l});break}}function S(c){const{offsetX:y,offsetY:l}=c??{},a=y>=0&&y<=i.width&&l>=0&&l<=i.height;return a||(console.log("超出了",{offsetX:y,offsetY:l}),o({onMove:!1})),a}function C(c){c==null||c.removeEventListener("mousemove",p),c==null||c.removeEventListener("mousedown",p),c==null||c.removeEventListener("mouseup",p)}return k.jsx(k.Fragment,{children:k.jsx("canvas",{ref:n,style:{border:"1px solid #999",borderRadius:"5px"}})})}const $e=g.memo(ye);export{$e as C,he as R,le as a,be as b,ge as c,xe as u};
